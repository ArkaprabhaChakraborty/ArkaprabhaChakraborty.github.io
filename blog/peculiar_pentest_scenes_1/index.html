<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Peculiar Pentest Scenes - Client-side HTTP Encryption Folly - Arkaprabha Chakraborty</title>
<meta name=description content="Hello fellow researcher! Welcome to the Chapter 1 of Peculiar Pentest Scenes series of blogs, where I take you through weird situations that I have encountered while being in different penetration testing engagements. In this post, I&rsquo;m going to take you through Client-side HTTP Encryption and it&rsquo;s nuances, how easy it can be to exploit web and mobile applications implementing this feature, and what are the possible right/correct ways to do it."><link rel=icon type=image/x-icon href=https://arkaprabhachakraborty.github.io/favicon.ico><link rel=apple-touch-icon-precomposed href=https://arkaprabhachakraborty.github.io/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=/css/style.min.184a655c5ad8596648622468e6696abf0cf0a2cf8266df17b4f7a36fe9c97551.css integrity="sha256-GEplXFrYWWZIYiRo5mlqvwzwos+CZt8XtPejb+nJdVE="><link rel=stylesheet href=/css/style.min.c4c04b3ef88e3d619ad4c7ee5e03048422bc55c4fefdc1f07657c1133670aa22.css integrity="sha256-xMBLPviOPWGa1MfuXgMEhCK8VcT+/cHwdlfBEzZwqiI="><link rel=stylesheet href=/css/style.min.21c5d8fe0a79d623b0adc1ce4bd4f6dd2c05cd939c9aaaa966ba7186b1464f4d.css integrity="sha256-IcXY/gp51iOwrcHOS9T23SwFzZOcmqqpZrpxhrFGT00="><script src=/js/script.min.08f04d96386c73c9bf4d160333f8f448c05a6e01c06770542ee0e013954ce930.js type=text/javascript integrity="sha256-CPBNljhsc8m/TRYDM/j0SMBabgHAZ3BULuDgE5VM6TA="></script></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><div class=header-top-left><h1 class="site-title noselect"><a href=/>Arkaprabha Chakraborty</a></h1><div class=theme-switcher><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-sun-high"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.828 14.828A4 4 0 109.172 9.172a4 4 0 005.656 5.656z"/><path d="M6.343 17.657l-1.414 1.414"/><path d="M6.343 6.343 4.929 4.929"/><path d="M17.657 6.343l1.414-1.414"/><path d="M17.657 17.657l1.414 1.414"/><path d="M4 12H2"/><path d="M12 4V2"/><path d="M20 12h2"/><path d="M12 20v2"/></svg></span></div><script>const STORAGE_KEY="user-color-scheme",defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");function switchTheme(){currentTheme=currentTheme==="dark"?"light":"dark",localStorage&&localStorage.setItem(STORAGE_KEY,currentTheme),document.documentElement.setAttribute("data-theme",currentTheme),changeGiscusTheme(currentTheme),document.body.dispatchEvent(new CustomEvent(currentTheme+"-theme-set"))}const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeGiscusTheme(currentTheme),document.body.dispatchEvent(new CustomEvent(currentTheme+"-theme-set"))};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme==="auto"?(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)):document.documentElement.setAttribute("data-theme",currentTheme),switchButton&&switchButton.addEventListener("click",switchTheme,!1),showContent()});function detectCurrentScheme(){return localStorage!==null&&localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}function changeGiscusTheme(e){function t(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}t({setConfig:{theme:e}})}</script><ul class="social-icons noselect"><li><a href=https://github.com/ArkaprabhaChakraborty title=Github rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-github"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></span></a></li><li><a href=https://www.linkedin.com/arkaprabhachakraborty title=Linkedin rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></span></a></li><li><a href=https://www.twitter.com/FValkyrie_17 title=X rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></span></a></li><li><a href=https://www.gitlab.com/ArkaprabhaChakraborty title=Gitlab rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gitlab"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 14l-9 7-9-7L6 3l3 7h6l3-7z"/></svg></span></a></li><li><a href=/index.xml title=RSS rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></span></a></li></ul></div><div class=header-top-right></div></div><nav class=noselect><a href=https://arkaprabhachakraborty.github.io/ title>Home</a>
<a href=https://arkaprabhachakraborty.github.io/about/ title>About</a>
<a href=https://arkaprabhachakraborty.github.io/tags/ title>Tags</a></nav></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">Peculiar Pentest Scenes - Client-side HTTP Encryption Folly</h1></header><div class="post-info noselect"><div class="post-date dt-published"><time datetime=2024-10-06>2024-10-06</time></div><a class="post-hidden-url u-url" href=/blog/peculiar_pentest_scenes_1/>/blog/peculiar_pentest_scenes_1/</a>
<a href=https://arkaprabhachakraborty.github.io/ class="p-name p-author post-hidden-author h-card" rel=me>map[email:arkaprabhachakraborty2001@gmail.com location:India name:Arkaprabha Chakraborty]</a><div class=post-taxonomies></div></div></div><details class="toc noselect"><summary>Table of Contents</summary><div class=inner><nav id=TableOfContents><ul><li><a href=#what-is-client-side-http-encryption>What is Client-side HTTP Encryption?</a><ul><li><a href=#how-it-works>How it works?</a></li></ul></li><li><a href=#run-through>Run Through</a><ul><li><a href=#background>Background</a></li><li><a href=#initial-observation-and-hypothesis>Initial Observation and Hypothesis</a></li><li><a href=#a-breakthrough>A Breakthrough</a></li><li><a href=#im-going-in>I&rsquo;m going in!</a></li></ul></li><li><a href=#what-could-have-been-done-better>What could have been done better?</a></li></ul></nav></div></details><script>var toc=document.querySelector(".toc");toc&&toc.addEventListener("click",function(){event.target.tagName!=="A"&&(event.preventDefault(),this.open?(this.open=!1,this.classList.remove("expanded")):(this.open=!0,this.classList.add("expanded")))})</script><div class="content e-content"><p>Hello fellow researcher! Welcome to the <em><strong>Chapter 1</strong></em> of <em><strong>Peculiar Pentest Scenes</strong></em> series of blogs, where I take you through weird situations that I have encountered while being in different penetration testing engagements. In this post, I&rsquo;m going to take you through <strong>Client-side HTTP Encryption</strong> and it&rsquo;s nuances, how easy it can be to exploit web and mobile applications implementing this <em>feature</em>, and what are the possible <em>right/correct</em> ways to do it.</p><h2 id=what-is-client-side-http-encryption><div><a href=#what-is-client-side-http-encryption>#
</a>What is Client-side HTTP Encryption?</div></h2><p>Before you start screaming, NO! It&rsquo;s NOT SSL/TLS. NO! It&rsquo;s not E2EE either. Client-side HTTP Encryption (also some researchers call it Application Layer Encryption) means sending and receiving encrypted HTTP requests and responses. Basically requests like POST, PUT, PATCH etc, or their data are sent in an encrypted and encoded wrap.</p><h3 id=how-it-works><div><a href=#how-it-works>##
</a>How it works?</div></h3><p>I have observed there are 2 broadly used ways in which Client-side HTTP Encryption works:</p><ol><li>Total Encapsulation: Encrypting and encapsulating an entire request, including methods and headers within a json.
<img src=https://raw.githubusercontent.com/ArkaprabhaChakraborty/ArkaprabhaChakraborty.github.io/refs/heads/main/assets/Client-side-HTTP-Encryption/Total%20Encapsulation.png alt=image></li><li>Request Body Encryption: Encrypting and encapsulating the body parameters of a request within a json.
<img src=https://raw.githubusercontent.com/ArkaprabhaChakraborty/ArkaprabhaChakraborty.github.io/refs/heads/main/assets/Client-side-HTTP-Encryption/Request%20Body%20Encryption.png alt=image></li></ol><p>This <a href=https://unifiedid.com/docs/getting-started/gs-encryption-decryption>article</a> from Unified ID is a good explanation of how its works with an example implementation.</p><h2 id=run-through><div><a href=#run-through>#
</a>Run Through</div></h2><h3 id=background><div><a href=#background>##
</a>Background</div></h3><p>I was performing a pentest engagement of a multi-platform application used by the employees of a bank. The application could be used as a web or an android application, which made it clear for me that the application backend was same for both. I started by connecting over their VPN and browsing the web application (after logging in with the credentials I was provided) through Burp and ZAP (in Attack mode). I find ZAP&rsquo;s attack mode more useful as it rules out some of the basic test cases for me.</p><blockquote><p>PS a detailed run through is not possible because of &ldquo;obvious reasons&rdquo; but I have cherry picked the most interesting parts!</p></blockquote><h3 id=initial-observation-and-hypothesis><div><a href=#initial-observation-and-hypothesis>##
</a>Initial Observation and Hypothesis</div></h3><p>After a while I noticed certain requests, more specifically POST requests, having body in the following format:
<img src=https://raw.githubusercontent.com/ArkaprabhaChakraborty/ArkaprabhaChakraborty.github.io/refs/heads/main/assets/Client-side-HTTP-Encryption/Original%20Request%20Response.png alt=image></p><p>Clearly the request body was encrypted. Typically, this a good primary defense for mobile applications but for web applications implementing it can be a headache because of the nuances. One of the major ones is the IV being a constant throughout a session or worse being a complete constant just fetched through an async request.</p><blockquote><p>Trivia: An initialization vector (IV) is a random value used alongside a secret key for data encryption to help prevent cyber attacks. Also known as a nonce (number used once), this value is used only once per session, ensuring that a potential attacker cannot decrypt the message without authorization.</p></blockquote><p>To confirm this hypothesis, I observed and compared same requests made at different times (after refreshing the browser) using both ZAP&rsquo;s diff add-on and Burp&rsquo;s comparer. Apart from the headers, the payloads were identical which meant the IV could be grabbed via some source code review and performing some really <em>silly</em> overrides.</p><p>Now it was time to find the encryption code in a huge 20,000+ lines minified javascript code. :)</p><h3 id=a-breakthrough><div><a href=#a-breakthrough>##
</a>A Breakthrough</div></h3><p>After searching through many lines of code using the phrase &ldquo;encrypt&rdquo; I stumbled across an interesting block at the very end of the minified mumbo-jumbo. It seemed like a block of code belonging to the library <a href=https://www.npmjs.com/package/crypto-js>crypto-js</a>. All thanks to the beautiful readme provided by the library&rsquo;s maintainers and the community, which had the exact same example implementation of an <code>AES.encrypt()</code> block.</p><p>Time for the chrome&rsquo;s underrated feature: <a href=https://developer.chrome.com/docs/devtools/overrides>Browser based overrides</a>! I have shown a simple example using my blog on how to perform an override.
<img src=https://raw.githubusercontent.com/ArkaprabhaChakraborty/ArkaprabhaChakraborty.github.io/refs/heads/main/assets/Client-side-HTTP-Encryption/How%20to%20override.png alt=image-showing-how-to-override>
I dropped in some <code>console.log()</code> within the blocks like shown below to grab the internal working of the block.
<img src=https://raw.githubusercontent.com/ArkaprabhaChakraborty/ArkaprabhaChakraborty.github.io/refs/heads/main/assets/Client-side-HTTP-Encryption/override.png alt=image></p><p>Lo and behold I had the IV in my browser console. I verified it by calling the <code>decrypt()</code> function (shown in the above screenshot) and passing the IV along with the <code>encryptedRequest</code> value. It gave me back the decrypted request parameters being used. The code was basically using the same IV input as the key, or, vice-versa. Either way I now have a way to decrypt the requests.</p><p>Now I just have to make a simple gadget in which I can put the IV and edit the requests or responses. I decided to reuse the code block from the minified code of the very web application being assessed to do this.</p><p><em><strong>app.js</strong></em></p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff6ac1>const</span> express <span style=color:#ff6ac1>=</span> require(<span style=color:#5af78e>&#39;express&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff6ac1>const</span> bodyParser <span style=color:#ff6ac1>=</span> require(<span style=color:#5af78e>&#39;body-parser&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff6ac1>const</span> cors <span style=color:#ff6ac1>=</span> require(<span style=color:#5af78e>&#39;cors&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff6ac1>const</span> nc <span style=color:#ff6ac1>=</span> require(<span style=color:#5af78e>&#39;crypto-js&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>const</span> app <span style=color:#ff6ac1>=</span> express();
</span></span><span style=display:flex><span><span style=color:#ff6ac1>const</span> port <span style=color:#ff6ac1>=</span> <span style=color:#ff9f43>3000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.use(cors({ origin<span style=color:#ff6ac1>:</span> <span style=color:#5af78e>&#39;*&#39;</span> }));
</span></span><span style=display:flex><span>app.use(bodyParser.json());
</span></span><span style=display:flex><span>app.use(express.<span style=color:#ff6ac1>static</span>(__dirname));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>class</span> Base64EncrypterDecrypter {
</span></span><span style=display:flex><span>    encryptText(e, i) {
</span></span><span style=display:flex><span>        <span style=color:#ff5c57>let</span> n <span style=color:#ff6ac1>=</span> nc.enc.Utf8.parse(i),
</span></span><span style=display:flex><span>            a <span style=color:#ff6ac1>=</span> nc.enc.Utf8.parse(i);
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> nc.AES.encrypt(nc.enc.Utf8.parse(e.toString()), n, {
</span></span><span style=display:flex><span>            keySize<span style=color:#ff6ac1>:</span> <span style=color:#ff9f43>16</span>,
</span></span><span style=display:flex><span>            iv<span style=color:#ff6ac1>:</span> a,
</span></span><span style=display:flex><span>            mode<span style=color:#ff6ac1>:</span> nc.mode.CBC,
</span></span><span style=display:flex><span>            padding<span style=color:#ff6ac1>:</span> nc.pad.Pkcs7
</span></span><span style=display:flex><span>        }).toString();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    decryptText(e, i) {
</span></span><span style=display:flex><span>        <span style=color:#ff5c57>let</span> n <span style=color:#ff6ac1>=</span> nc.enc.Utf8.parse(i),
</span></span><span style=display:flex><span>            a <span style=color:#ff6ac1>=</span> nc.enc.Utf8.parse(i);
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> nc.AES.decrypt(e, n, {
</span></span><span style=display:flex><span>            keySize<span style=color:#ff6ac1>:</span> <span style=color:#ff9f43>16</span>,
</span></span><span style=display:flex><span>            iv<span style=color:#ff6ac1>:</span> a,
</span></span><span style=display:flex><span>            mode<span style=color:#ff6ac1>:</span> nc.mode.CBC,
</span></span><span style=display:flex><span>            padding<span style=color:#ff6ac1>:</span> nc.pad.Pkcs7
</span></span><span style=display:flex><span>        }).toString(nc.enc.Utf8);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>const</span> encrypterDecrypter <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>new</span> Base64EncrypterDecrypter();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.post(<span style=color:#5af78e>&#39;/encrypt&#39;</span>, (req, res) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>const</span> { text, key } <span style=color:#ff6ac1>=</span> req.body;
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>const</span> encryptedText <span style=color:#ff6ac1>=</span> encrypterDecrypter.encryptText(text, key);
</span></span><span style=display:flex><span>    res.json({ encryptedText });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.post(<span style=color:#5af78e>&#39;/decrypt&#39;</span>, (req, res) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>const</span> { encryptedText, key } <span style=color:#ff6ac1>=</span> req.body;
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>const</span> decryptedText <span style=color:#ff6ac1>=</span> encrypterDecrypter.decryptText(encryptedText, key);
</span></span><span style=display:flex><span>    res.json({ decryptedText });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.get(<span style=color:#5af78e>&#39;/&#39;</span>, (req, res) =&gt; {
</span></span><span style=display:flex><span>    res.sendFile(path.join(__dirname, <span style=color:#5af78e>&#39;/index.html&#39;</span>));
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.listen(port, () =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#5af78e>`Server is running on http://localhost:</span><span style=color:#5af78e>${</span>port<span style=color:#5af78e>}</span><span style=color:#5af78e>`</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p><em><strong>index.html</strong></em></p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#78787e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#ff6ac1>html</span> <span style=color:#57c7ff>lang</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#ff6ac1>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>meta</span> <span style=color:#57c7ff>charset</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>meta</span> <span style=color:#57c7ff>name</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;viewport&#34;</span> <span style=color:#57c7ff>content</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>title</span>&gt;Encryption and Decryption&lt;/<span style=color:#ff6ac1>title</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>style</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>body</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>font-family</span>: Arial, <span style=color:#ff6ac1>sans-serif</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>margin</span>: <span style=color:#ff9f43>20</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>background-color</span>: <span style=color:#ff9f43>#f4f4f4</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>h1</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>text-align</span>: <span style=color:#ff6ac1>center</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>color</span>: <span style=color:#ff9f43>#333</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>form</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>margin-bottom</span>: <span style=color:#ff9f43>20</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>background-color</span>: <span style=color:#ff9f43>#fff</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>padding</span>: <span style=color:#ff9f43>20</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>border-radius</span>: <span style=color:#ff9f43>8</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>box-shadow</span>: <span style=color:#ff9f43>0</span> <span style=color:#ff9f43>0</span> <span style=color:#ff9f43>10</span><span style=color:#9aedfe>px</span> <span style=color:#ff5c57>rgba</span>(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0.1</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>label</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>display</span>: <span style=color:#ff6ac1>block</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>margin-bottom</span>: <span style=color:#ff9f43>10</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>input</span><span style=color:#ff6ac1>,</span> <span style=color:#ff6ac1>textarea</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>width</span>: <span style=color:#ff9f43>100</span><span style=color:#9aedfe>%</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>padding</span>: <span style=color:#ff9f43>10</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>margin-bottom</span>: <span style=color:#ff9f43>15</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>box-sizing</span>: <span style=color:#ff6ac1>border-box</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>button</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>background-color</span>: <span style=color:#ff9f43>#4CAF50</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>color</span>: <span style=color:#ff6ac1>white</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>padding</span>: <span style=color:#ff9f43>10</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>border</span>: <span style=color:#ff6ac1>none</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>cursor</span>: <span style=color:#ff6ac1>pointer</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>button</span>:<span style=color:#ff9f43>hover</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>background-color</span>: <span style=color:#ff9f43>#45a049</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        .<span style=color:#f3f99d>result-container</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>margin-top</span>: <span style=color:#ff9f43>20</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>padding</span>: <span style=color:#ff9f43>20</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>background-color</span>: <span style=color:#ff9f43>#fff</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>border-radius</span>: <span style=color:#ff9f43>8</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>box-shadow</span>: <span style=color:#ff9f43>0</span> <span style=color:#ff9f43>0</span> <span style=color:#ff9f43>10</span><span style=color:#9aedfe>px</span> <span style=color:#ff5c57>rgba</span>(<span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0</span>, <span style=color:#ff9f43>0.1</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>overflow</span>: <span style=color:#ff6ac1>hidden</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>word-wrap</span>: <span style=color:#ff6ac1>break-word</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>textarea</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>height</span>: <span style=color:#ff9f43>150</span><span style=color:#9aedfe>px</span>;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>resize</span>: <span style=color:#ff6ac1>none</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff6ac1>style</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#ff6ac1>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#ff6ac1>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>h1</span>&gt;Encryption and Decryption&lt;/<span style=color:#ff6ac1>h1</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>form</span> <span style=color:#57c7ff>id</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;encryptionForm&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>label</span> <span style=color:#57c7ff>for</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;text&#34;</span>&gt;Text:&lt;/<span style=color:#ff6ac1>label</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>textarea</span> <span style=color:#57c7ff>id</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;plainText&#34;</span> <span style=color:#57c7ff>name</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;plainText&#34;</span> <span style=color:#57c7ff>required</span>&gt;&lt;/<span style=color:#ff6ac1>textarea</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>br</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>label</span> <span style=color:#57c7ff>for</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;encryptionKey&#34;</span>&gt;Key:&lt;/<span style=color:#ff6ac1>label</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>input</span> <span style=color:#57c7ff>type</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;text&#34;</span> <span style=color:#57c7ff>id</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;encryptionKey&#34;</span> <span style=color:#57c7ff>name</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;encryptionKey&#34;</span> <span style=color:#57c7ff>value</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;5fc6801bada241b3&#34;</span> <span style=color:#57c7ff>required</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>br</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>button</span> <span style=color:#57c7ff>type</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;button&#34;</span> <span style=color:#57c7ff>onclick</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;encrypt()&#34;</span>&gt;Encrypt&lt;/<span style=color:#ff6ac1>button</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff6ac1>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>strong</span>&gt;Result&lt;/<span style=color:#ff6ac1>strong</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>div</span> <span style=color:#57c7ff>id</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;encryptionResult&#34;</span> <span style=color:#57c7ff>class</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;result-container&#34;</span>&gt;&lt;/<span style=color:#ff6ac1>div</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>br</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>form</span> <span style=color:#57c7ff>id</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;decryptionForm&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>label</span> <span style=color:#57c7ff>for</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;encryptedText&#34;</span>&gt;Encrypted Text:&lt;/<span style=color:#ff6ac1>label</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>textarea</span> <span style=color:#57c7ff>id</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;encryptedText&#34;</span> <span style=color:#57c7ff>name</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;encryptedText&#34;</span> <span style=color:#57c7ff>required</span>&gt;&lt;/<span style=color:#ff6ac1>textarea</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>br</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>label</span> <span style=color:#57c7ff>for</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;decryptionKey&#34;</span>&gt;Key:&lt;/<span style=color:#ff6ac1>label</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>input</span> <span style=color:#57c7ff>type</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;text&#34;</span> <span style=color:#57c7ff>id</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;decryptionKey&#34;</span> <span style=color:#57c7ff>name</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;decryptionKey&#34;</span> <span style=color:#57c7ff>value</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;4fc6901baka341c5&#34;</span> <span style=color:#57c7ff>required</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>br</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#ff6ac1>button</span> <span style=color:#57c7ff>type</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;button&#34;</span> <span style=color:#57c7ff>onclick</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;decrypt()&#34;</span>&gt;Decrypt&lt;/<span style=color:#ff6ac1>button</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff6ac1>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>strong</span>&gt; Result &lt;/<span style=color:#ff6ac1>strong</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>div</span> <span style=color:#57c7ff>id</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;decryptionResult&#34;</span> <span style=color:#57c7ff>class</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;result-container&#34;</span>&gt;&lt;/<span style=color:#ff6ac1>div</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#ff6ac1>script</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>async</span> <span style=color:#ff5c57>function</span> encrypt() {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>const</span> text <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>document</span>.getElementById(<span style=color:#5af78e>&#39;plainText&#39;</span>).value;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>const</span> key <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>document</span>.getElementById(<span style=color:#5af78e>&#39;encryptionKey&#39;</span>).value;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>const</span> response <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>await</span> fetch(<span style=color:#5af78e>&#39;http://localhost:3000/encrypt&#39;</span>, {
</span></span><span style=display:flex><span>                method<span style=color:#ff6ac1>:</span> <span style=color:#5af78e>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>                headers<span style=color:#ff6ac1>:</span> {
</span></span><span style=display:flex><span>                    <span style=color:#5af78e>&#39;Content-Type&#39;</span><span style=color:#ff6ac1>:</span> <span style=color:#5af78e>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                body<span style=color:#ff6ac1>:</span> JSON.stringify({ text, key }),
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>const</span> data <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>await</span> response.json();
</span></span><span style=display:flex><span>            displayResult(data.encryptedText, <span style=color:#5af78e>&#39;encryptionResult&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>async</span> <span style=color:#ff5c57>function</span> decrypt() {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>const</span> encryptedText <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>document</span>.getElementById(<span style=color:#5af78e>&#39;encryptedText&#39;</span>).value;
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>const</span> key <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>document</span>.getElementById(<span style=color:#5af78e>&#39;decryptionKey&#39;</span>).value;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>const</span> response <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>await</span> fetch(<span style=color:#5af78e>&#39;http://localhost:3000/decrypt&#39;</span>, {
</span></span><span style=display:flex><span>                method<span style=color:#ff6ac1>:</span> <span style=color:#5af78e>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>                headers<span style=color:#ff6ac1>:</span> {
</span></span><span style=display:flex><span>                    <span style=color:#5af78e>&#39;Content-Type&#39;</span><span style=color:#ff6ac1>:</span> <span style=color:#5af78e>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                body<span style=color:#ff6ac1>:</span> JSON.stringify({ encryptedText, key }),
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>const</span> data <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>await</span> response.json();
</span></span><span style=display:flex><span>            displayResult(data.decryptedText, <span style=color:#5af78e>&#39;decryptionResult&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff5c57>function</span> displayResult(result, resultContainerId) {
</span></span><span style=display:flex><span>            <span style=color:#ff6ac1>const</span> resultDiv <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>document</span>.getElementById(resultContainerId);
</span></span><span style=display:flex><span>            resultDiv.innerHTML <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>`&lt;p&gt;</span><span style=color:#5af78e>${</span>result<span style=color:#5af78e>}</span><span style=color:#5af78e>&lt;/p&gt;`</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    &lt;/<span style=color:#ff6ac1>script</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#ff6ac1>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#ff6ac1>html</span>&gt;
</span></span></code></pre></div><p>You can run the <code>app.js</code> with <code>node</code> by simply keeping both app.js and index.html files in the same directory and running:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ node app.js
</span></span></code></pre></div><h3 id=im-going-in><div><a href=#im-going-in>##
</a>I&rsquo;m going in!</div></h3><p>Now it was time to dig further. I intercepted a simple login response from the server which gave me tons of information.
<img src=https://raw.githubusercontent.com/ArkaprabhaChakraborty/ArkaprabhaChakraborty.github.io/refs/heads/main/assets/Client-side-HTTP-Encryption/Decrypted%20messages.png alt=image>
I got access to multiple keys like partner activation key, private and public keys but nothing much <em>damaging</em>.</p><p>Next I tried to upload a file. Upon inspection of the proxy history I saw two POST requests being made. First one had a shorter encrypted body than the second. This was an obvious giveaway that the second one was uploading the file content, but then what was the first one? I decided to decrypt the response for the first request in the chain aaaannnnnd&mldr;&mldr;&mldr;
<img src=https://raw.githubusercontent.com/ArkaprabhaChakraborty/ArkaprabhaChakraborty.github.io/refs/heads/main/assets/Client-side-HTTP-Encryption/AWS%20Bucket%20keys%20leak%20Credential.png alt=image></p><p>Kaboom! AWS Secret Keys! Now that&rsquo;s some serious <em>damage</em>! I quickly set up the aws cli and fetched everything from the buckets.
<img src=https://raw.githubusercontent.com/ArkaprabhaChakraborty/ArkaprabhaChakraborty.github.io/refs/heads/main/assets/Client-side-HTTP-Encryption/AWS%20Bucket%20keys%20leak%20Credential%20configuration.png alt=image>
<img src=https://raw.githubusercontent.com/ArkaprabhaChakraborty/ArkaprabhaChakraborty.github.io/refs/heads/main/assets/Client-side-HTTP-Encryption/AWS%20Bucket%20info%20disclosure.png alt=image></p><p>I could have gone further but like most pentest engagements, I had limited time so I had to stop here. Also for the organization, this was enough evidence of compromise.</p><h2 id=what-could-have-been-done-better><div><a href=#what-could-have-been-done-better>#
</a>What could have been done better?</div></h2><ol><li>Having application layer encryption or similar &ldquo;maskings&rdquo; aren&rsquo;t always enough for shit designs. It&rsquo;s important to learn and study secure system design (doesn&rsquo;t matter whether you are a developer, software engineer or security engineer).</li><li>Shortcut implementation of complicated security techniques often lead to more disasters. Later in this case, the organization had actually implemented rotational IV and secret keys which could be fetched by the frontend, provided if a specific nonce attribute matched (kinda like Anti-CSRF tokens you can say).</li><li>Multi-platform -> At least &ldquo;semi-multi&rdquo; backend. :)</li></ol></div></article><div class="pagination post-pagination"><div class="left pagination-item disabled"></div><div class="right pagination-item"><a href=/blog/portfolio_with_hugo/>Setup a lovely little portfolio with hugo</a></div></div><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-arkaprabhaachakraborty-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main><footer class="common-footer noselect"><div class=common-footer-bottom><div style=display:flex;align-items:center;gap:8px>© Arkaprabha Chakraborty, 2024</div><div style=display:flex;align-items:center></div><div>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/Junyi-99/hugo-theme-anubis2>Anubis2</a>.<br></div></div><p class="h-card vcard"><a href=https://arkaprabhachakraborty.github.io/ class="p-name u-url url fn" rel=me>map[email:arkaprabhachakraborty2001@gmail.com location:India name:Arkaprabha Chakraborty]</a></p></footer></div></body></html>